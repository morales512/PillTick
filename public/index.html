<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PillTick – Recordatorio Inteligente de Medicamentos</title>

  <!-- AQUÍ ESTÁ LA REFERENCIA AL CSS – ¡NUNCA LA QUITES! -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* —— MODAL (estilos mínimos inline para que funcione aunque falle el CSS) —— */
    .modal-bg {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal-bg[style*="flex"] { display: flex !important; }
    .modal-card {
      background: #fff;
      padding: 35px;
      width: 90%;
      max-width: 500px;
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.4);
    }
    .modal-card button { width: 100%; padding: 14px; margin-top: 15px; font-size: 1.1em; }
    .modal-card .cancel { background: #7f8c8d; }
  </style>
</head>
<body>

  <header>
    <h1>PillTick</h1>
    <div>
      <span id="user-name" style="font-weight:bold;"></span>
      <button id="login-btn">Iniciar sesión con Google</button>
      <button id="logout-btn" style="display:none;">Cerrar sesión</button>
    </div>
  </header>

  <main id="app" style="display:none;">

    <!-- FORMULARIO AGREGAR / EDITAR -->
    <section class="form-card">
      <h2 id="form-title">Agregar medicamento</h2>

      <label>Nombre del medicamento</label>
      <input id="med-name" type="text" placeholder="Ej: Paracetamol" required>

      <label>Dosis</label>
      <input id="med-dose" type="text" placeholder="Ej: 1 comprimido de 500mg" required>

      <label>Hora de la primera toma del día</label>
      <input id="med-first-time" type="time" value="08:00" required>

      <label>Fecha de inicio</label>
      <input id="med-start" type="date" required>

      <label>Fecha de fin (opcional)</label>
      <input id="med-end" type="date">

      <label>Veces al día</label>
      <input id="med-times" type="number" min="1" max="12" value="3" required>

      <label>Imagen de la caja (opcional)</label>
      <input id="med-img" type="file" accept="image/*">

      <label>Receta médica en PDF (opcional)</label>
      <input id="med-pdf" type="file" accept="application/pdf">

      <div style="margin-top:25px;">
        <div id="form-error" class="error-msg"></div>
        <button id="add-med-btn">Guardar medicamento</button>
        <button id="update-med-btn" style="display:none; background:#e67e22;">Actualizar medicamento</button>
        <button id="cancel-edit-btn" style="display:none; background:#95a5a6; margin-left:10px;">Cancelar</button>
      </div>
    </section>

    <!-- PERMISO DE NOTIFICACIONES -->
    <div id="notification-permission" style="display:none;">
      <strong>Activa las notificaciones</strong> para que PillTick te avise cuando toque tomar tus medicamentos
      <button id="enable-notifications">Activar ahora</button>
    </div>

    <h2 style="margin-top:40px;">Mis medicamentos activos</h2>
    <div id="med-list">
      <!-- Aquí se cargan las tarjetas automáticamente -->
    </div>
  </main>

<!-- MODAL DE EDICIÓN – VERSIÓN MEJORADA -->
<div id="edit-modal" class="modal-bg">
  <div class="modal-card">
    <h2>Editar medicamento</h2>

    <div class="modal-scroll">
      <label>Nombre</label>
      <input id="edit-name" type="text">

      <label>Dosis</label>
      <input id="edit-dose" type="text">

      <label>Hora primera toma</label>
      <input id="edit-first-time" type="time">

      <label>Fecha inicio</label>
      <input id="edit-start" type="date">

      <label>Fecha fin (opcional)</label>
      <input id="edit-end" type="date">

      <label>Veces al día</label>
      <input id="edit-times" type="number" min="1" max="12">

      <label>Nueva imagen (opcional)</label>
      <input id="edit-img" type="file" accept="image/*">

      <label>Nuevo PDF (opcional)</label>
      <input id="edit-pdf" type="file" accept="application/pdf">
    </div>

    <div style="margin-top:20px;">
      <button id="save-edit-btn">Guardar cambios</button>
      <button id="cancel-modal-btn" class="cancel">Cancelar</button>
    </div>
  </div>
</div>

<!-- ====== CHATBOT FLOTANTE (FUNCIONA SÍ O SÍ) ====== -->
<div id="chatbot-container">
  <div id="chatbot-bubble">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
      <path d="M21 11.5a8.5 8.5 0 0 1-8.4 8.5c-1.4 0-2.7-.3-3.9-.9l-4.4 1.4 1.4-4.4a8.5 8.5 0 0 1-.9-3.9A8.5 8.5 0 0 1 12.5 3h.5a8.5 8.5 0 0 1 8 8.5Z"/>
      <path d="M9 10h.01"/><path d="M15 10h.01"/><path d="M9.5 15a3.5 3.5 0 0 0 5 0"/>
    </svg>
  </div>

  <div id="chatbot-window">
    <div id="chat-header">
      <strong>PillTick Asistente</strong>
      <button id="chat-close">×</button>
    </div>
    <div id="chat-messages">
      <div class="message bot-message">¡Hola! Pregúntame sobre medicamentos, salud, ejercicio o sueño</div>
    </div>
    <div id="chat-input-area">
      <input type="text" id="chat-input" placeholder="Escribe aquí...">
      <button id="chat-send">Enviar</button>
    </div>
  </div>
</div>

  <!-- SCRIPT PRINCIPAL -->
  <script type="module" src="app.js"></script>
</body>
</html>